<script>
// ‚úÖ CART SYSTEM
const cartCount = document.getElementById("cartCount");
let cart = JSON.parse(localStorage.getItem("cart")) || [];
cartCount.textContent = cart.length;

// Helper function to update total in localStorage
function updateCartTotal() {
  const total = cart.reduce((sum, item) => sum + item.price, 0);
  localStorage.setItem("cartTotal", total);
  return total;
}

// Add-to-cart logic
document.querySelectorAll(".btn.btn-primary.w-100").forEach(btn => {
  btn.addEventListener("click", (e) => {
    e.preventDefault();
    
    const card = btn.closest(".card");
    if (!card) return;

    const name = card.querySelector(".card-title")?.textContent.trim() || "Unknown";

    // ‚úÖ More reliable way to get price
    const priceText = [...card.querySelectorAll(".card-text")]
      .map(p => p.textContent.trim())
      .find(text => text.includes("‚Çπ")) || "‚Çπ0";

    // Remove ‚Çπ and commas
    const price = parseInt(priceText.replace(/[‚Çπ,]/g, "")) || 0;
    const image = card.querySelector("img")?.getAttribute("src") || "";

    const item = { name, price, image };
    cart.push(item);

    // Save to localStorage
    localStorage.setItem("cart", JSON.stringify(cart));
    cartCount.textContent = cart.length;
    const total = updateCartTotal();

    console.log(`üõí Added ${name} | ‚Çπ${price}`);
    console.log(`üí∞ Total: ‚Çπ${total}`);

    // Button feedback
    btn.textContent = "‚úÖ Added!";
    btn.classList.replace("btn-primary", "btn-success");
    setTimeout(() => {
      btn.textContent = "Add to cart";
      btn.classList.replace("btn-success", "btn-primary");
    }, 1500);
  });
});

// üîç SEARCH FUNCTION
const searchForm = document.querySelector("form");
const searchInput = searchForm.querySelector("input[type='search']");
const cards = document.querySelectorAll(".card");

searchForm.addEventListener("submit", (e) => {
  e.preventDefault();
  const query = searchInput.value.toLowerCase().trim();
  let found = false;

  cards.forEach(card => {
    const name = card.querySelector(".card-title")?.textContent.toLowerCase() || "";
    if (name.includes(query)) {
      card.scrollIntoView({ behavior: "smooth", block: "center" });
      card.classList.add("border", "border-success");
      setTimeout(() => card.classList.remove("border", "border-success"), 2000);
      found = true;
    }
  });

  if (!found) alert("‚ùå Product not found!");
});
</script>
