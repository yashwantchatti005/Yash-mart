<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Your Cart | Yashmart</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="icon" type="image/svg" href="cart-dash.svg">
  <link rel="stylesheet" href="wepsite.css">

  <style>
    body { background-color: #f8f9fa; }

    .card { transition: transform 0.3s ease, box-shadow 0.3s ease; }
    .card:hover { transform: scale(1.05); box-shadow: 0 8px 20px rgba(0,0,0,0.2); }

    #successMessage { color: red; font-weight: bold; }

    #orderForm label { color: #000 !important; }
    #orderForm input, #orderForm textarea { color: #007bff !important; }

    #discountModal .modal-title, #discountModal h5, #discountDetails {
      color: #000 !important;
    }

    .van-container {
      width: 100%;
      height: 120px;
      position: relative;
      overflow: hidden;
    }
    .van {
      position: absolute;
      bottom: 0;
      width: 140px;
      animation: drive 2s linear infinite;
    }
    @keyframes drive {
      0% { left: -160px; }
      100% { left: 110%; }
    }
  </style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg bg-dark navbar-dark">
  <div class="container-fluid">
    <a class="navbar-brand" href="webpage1.html">YASH-MART</a>
    <a href="cart.html" class="btn btn-warning">Cart</a>
  </div>
</nav>

<!-- MAIN CONTAINER -->
<div class="container my-5">
  <div id="greeting" class="text-center text-info mb-3"></div>

  <h2 class="text-center mb-4">üõí Your Shopping Cart</h2>
  <div id="cartContainer" class="row g-3"></div>

  <!-- Progress -->
  <div class="mt-4">
    <div class="progress" style="height: 25px;">
      <div id="progressBar" class="progress-bar bg-success" style="width: 0%">0%</div>
    </div>
    <p id="deliveryMsg" class="mt-2 text-center fw-bold"></p>
  </div>

  <div class="text-center mt-4">
    <h4 id="totalAmount">Total: ‚Çπ0</h4>
    <h4 id="finalAmount" class="fw-bold text-success"></h4>

    <!-- Coupon Box -->
    <div class="container text-center mt-3">
      <h4>Have a Coupon?</h4>
      <h6>WELCOME10</h6>
      <h6>FIRST50</h6>
      <div class="input-group justify-content-center" style="max-width:350px;margin:auto;">
        <input type="text" id="couponInput" class="form-control" placeholder="Enter coupon code">
        <button class="btn btn-primary" id="applyCouponBtn">Apply</button>
      </div>
      <p id="couponMsg" class="mt-2 fw-bold"></p>
    </div>

    <button id="checkoutBtn" class="btn btn-success mt-3 me-2">Proceed to Checkout</button>
    <button id="clearCartBtn" class="btn btn-danger mt-3">Clear Cart</button>
  </div>
</div>

<!-- ADDRESS MODAL -->
<div class="modal fade" id="addressModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title">Enter Your Delivery Details</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <form id="orderForm">

          <div class="mb-3">
            <label class="form-label">Full Name</label>
            <input type="text" id="name" class="form-control" required>
          </div>

          <div class="mb-3">
            <label class="form-label">Phone Number</label>
            <input type="tel" id="phone" class="form-control" required>
          </div>

          <div class="mb-3">
            <label class="form-label">Address</label>
            <textarea id="address" class="form-control" rows="2" required></textarea>
          </div>

          <div class="text-center">
            <button type="submit" class="btn btn-success">Place Order</button>
          </div>

        </form>
      </div>
    </div>
  </div>
</div>

<!-- DISCOUNT MODAL -->
<div class="modal fade" id="discountModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content text-center">
      <div class="modal-header bg-success text-white">
        <h5 class="modal-title">üéâ Discount Applied!</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <h5 class="fw-bold mt-3">You got a 10% discount on your order!</h5>
        <p id="discountDetails" class="fw-bold mt-3"></p>
      </div>
    </div>
  </div>
</div>

<!-- SUCCESS MODAL -->
<div class="modal fade" id="successModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content text-center">
      <div class="modal-header bg-success text-white">
        <h5 class="modal-title">Order Status</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <h5 id="successMessage"></h5>

        <div id="vanBlock" style="display:none;">
          <div class="van-container">
            <img src="van.gif" class="van">
          </div>
          <p class="mt-3 fw-bold text-success">Processing your order...</p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- TOAST -->
<div class="toast-container position-fixed bottom-0 end-0 p-3">
  <div id="liveToast" class="toast text-white bg-success">
    <div class="d-flex">
      <div class="toast-body" id="toastMsg">Action done</div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
    </div>
  </div>
</div>

<!-- FOOTER -->
<footer class="bg-dark text-white text-center py-3">
  <p class="mb-0">&copy; 2025 YASHMART - All Rights Reserved</p>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
/*=====================
  VARIABLES
======================*/
const cartContainer = document.getElementById("cartContainer");
const totalAmount = document.getElementById("totalAmount");
const finalAmount = document.getElementById("finalAmount");
const progressBar = document.getElementById("progressBar");
const deliveryMsg = document.getElementById("deliveryMsg");

const toast = new bootstrap.Toast(document.getElementById("liveToast"));
const discountModal = new bootstrap.Modal(document.getElementById("discountModal"));
const addressModal = new bootstrap.Modal(document.getElementById("addressModal"));
const successModal = new bootstrap.Modal(document.getElementById("successModal"));

let cartItems = JSON.parse(localStorage.getItem("cart")) || [];
let total = 0;
let finalTotal = 0;
let discountShown = false;

let appliedCoupon = localStorage.getItem("coupon") || "";
let couponDiscount = 0;

/*=====================
  TOAST FUNCTION
======================*/
function showToast(msg, type="success") {
  const toastEl = document.getElementById("liveToast");
  toastEl.classList.remove("bg-success", "bg-danger");
  toastEl.classList.add(type === "error" ? "bg-danger" : "bg-success");
  document.getElementById("toastMsg").textContent = msg;
  toast.show();
}

/*=====================
  APPLY COUPON
======================*/
function applyCoupon() {
  const code = document.getElementById("couponInput").value.trim().toUpperCase();
  const msg = document.getElementById("couponMsg");

  if (!code) {
    msg.textContent = "Please enter a coupon!";
    msg.style.color = "red";
    return;
  }

  if (appliedCoupon) {
    msg.textContent = `Coupon "${appliedCoupon}" already applied!`;
    msg.style.color = "orange";
    return;
  }

  if (code === "WELCOME10") {
    appliedCoupon = "WELCOME10";
    couponDiscount = total * 0.10;
    msg.textContent = "10% discount applied!";
    msg.style.color = "green";
  }
  else if (code === "FIRST50") {
    appliedCoupon = "FIRST50";
    couponDiscount = 50;
    msg.textContent = "‚Çπ50 discount applied!";
    msg.style.color = "green";
  }
  else if (code === "FREESHIP") {
    appliedCoupon = "FREESHIP";
    couponDiscount = 0;
    deliveryMsg.textContent = "üéâ Free Delivery Applied!";
    msg.textContent = "Free delivery applied!";
    msg.style.color = "green";
  }
  else {
    msg.textContent = "Invalid coupon!";
    msg.style.color = "red";
    return;
  }

  localStorage.setItem("coupon", appliedCoupon);
  displayCart();
}

document.getElementById("applyCouponBtn").addEventListener("click", applyCoupon);

/*=====================
  DISPLAY CART
======================*/
function displayCart() {
  cartContainer.innerHTML = "";
  total = 0;

  if (cartItems.length === 0) {
    cartContainer.innerHTML =
      '<h5 class="text-center text-danger">Your cart is empty üõçÔ∏è</h5>';
    totalAmount.textContent = "Total: ‚Çπ0";
    finalAmount.textContent = "";
    updateProgress();
    return;
  }

  cartItems.forEach((item, index) => {
    if (!item.quantity) item.quantity = 1;

    total += item.price * item.quantity;

    cartContainer.innerHTML += `
      <div class="col-md-4">
        <div class="card h-100 shadow-sm">
          <img src="${item.image}" class="card-img-top" height="200">

          <div class="card-body text-center">
            <h5>${item.name}</h5>
            <p>‚Çπ${item.price} x ${item.quantity}</p>

            <div class="d-flex justify-content-center gap-2">
              <button class="btn btn-sm btn-outline-secondary" onclick="changeQuantity(${index}, -1)">-</button>
              <button class="btn btn-sm btn-outline-secondary" onclick="changeQuantity(${index}, 1)">+</button>
            </div>

            <button class="btn btn-danger btn-sm mt-2" onclick="removeItem(${index})">Remove</button>
          </div>
        </div>
      </div>
    `;
  });

  /* Auto Discount */
  if (total >= 499) {
    const discount = total * 0.10;
    finalTotal = total - discount;

    if (!discountShown) {
      discountDetails.innerHTML = `
        <p>Original Total: ‚Çπ${total.toFixed(2)}</p>
        <p>10% Discount: -‚Çπ${discount.toFixed(2)}</p>
        <h5 class="text-success">Final Total: ‚Çπ${finalTotal.toFixed(2)}</h5>
      `;
      discountModal.show();
      discountShown = true;
    }
  } else {
    finalTotal = total;
    discountShown = false;
  }

  /* Coupon Discount */
  if (appliedCoupon === "WELCOME10") {
    couponDiscount = total * 0.10;
  }

  if (appliedCoupon === "FIRST50") {
    couponDiscount = 50;
  }

  if (appliedCoupon) {
    finalTotal -= couponDiscount;
  }

  if (finalTotal < 0) finalTotal = 0;

  totalAmount.textContent = "Total: ‚Çπ" + total.toFixed(2);
  finalAmount.textContent = "Final Total: ‚Çπ" + finalTotal.toFixed(2);

  updateProgress();
}

/*=====================
  QUANTITY CHANGE
======================*/
function changeQuantity(index, delta) {
  cartItems[index].quantity = Math.max(1, cartItems[index].quantity + delta);
  localStorage.setItem("cart", JSON.stringify(cartItems));

  appliedCoupon = "";
  couponDiscount = 0;
  localStorage.removeItem("coupon");
  document.getElementById("couponMsg").textContent = "";

  displayCart();
}

/*=====================
  REMOVE ITEM
======================*/
function removeItem(index) {
  showToast(`${cartItems[index].name} removed`, "error");
  cartItems.splice(index, 1);

  localStorage.setItem("cart", JSON.stringify(cartItems));
  localStorage.removeItem("coupon");
  appliedCoupon = "";
  couponDiscount = 0;

  displayCart();
}

/*=====================
  PROGRESS BAR
======================*/
function updateProgress() {
  const percent = Math.min((total / 499) * 100, 100);

  progressBar.style.width = percent + "%";
  progressBar.textContent = Math.floor(percent) + "%";

  deliveryMsg.textContent =
    total >= 499
      ? "üéâ You unlocked Free Delivery!"
      : `Add ‚Çπ${(499 - total).toFixed(2)} more for Free Delivery.`;
}

/*=====================
  CHECKOUT
======================*/
document.getElementById("checkoutBtn").addEventListener("click", () => {
  if (cartItems.length === 0) {
    showToast("Your cart is empty!", "error");
  } else {
    addressModal.show();
  }
});

/*=====================
  PLACE ORDER
======================*/
document.getElementById("orderForm").addEventListener("submit", e => {
  e.preventDefault();

  addressModal.hide();
  document.getElementById("vanBlock").style.display = "block";
  successModal.show();

  setTimeout(() => {
    document.getElementById("vanBlock").style.display = "none";
    successMessage.innerHTML =
      "üéâ Thank you! Your order has been placed successfully.";

    localStorage.removeItem("cart");
    localStorage.removeItem("coupon");
    cartItems = [];

    displayCart();
  }, 2500);
});

/*=====================
  CLEAR CART
======================*/
document.getElementById("clearCartBtn").addEventListener("click", () => {
  if (cartItems.length === 0) {
    showToast("Your cart is already empty!", "error");
    return;
  }

  if (confirm("Are you sure you want to clear the cart?")) {
    localStorage.removeItem("cart");
    localStorage.removeItem("coupon");

    cartItems = [];
    displayCart();

    showToast("üóëÔ∏è Cart cleared!");
  }
});

/* INITIAL DISPLAY */
displayCart();
</script>

</body>
</html>
